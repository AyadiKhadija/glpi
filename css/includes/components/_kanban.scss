/**
 * ---------------------------------------------------------------------
 * GLPI - Gestionnaire Libre de Parc Informatique
 * Copyright (C) 2015-2021 Teclib' and contributors.
 *
 * http://glpi-project.org
 *
 * based on GLPI - Gestionnaire Libre de Parc Informatique
 * Copyright (C) 2003-2014 by the INDEPNET Development Team.
 *
 * ---------------------------------------------------------------------
 *
 * LICENSE
 *
 * This file is part of GLPI.
 *
 * GLPI is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 2 of the License, or
 * (at your option) any later version.
 *
 * GLPI is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with GLPI. If not, see <http://www.gnu.org/licenses/>.
 * ---------------------------------------------------------------------
 */

.kanban {
   position: relative;
   height: 100%;

   .kanban-toolbar {
      display: flex;
      align-items: center;
      margin-bottom: 5px;
      font-size: 14px;
      background-color: #fbfbfb;
      border: 1px solid #d6d6d6;
      padding: 10px;

      input[type=text][name=filter]:not([type=submit]):not([type=button]) {
         flex: 1 0 auto;
         border-radius: unset;
         background-color: white !important;
         padding: 5px 10px;
         font-size: 13px;
      }
      input[type=button].kanban-add-column:not([type=submit]):not([type=text]) {
         margin-left: 5px;
         padding: 7px 10px;
         font-size: 13px;
      }
      .fas {
         margin: auto auto auto 10px;
         font-size: 1.2em;
         cursor: pointer;
      }
      .select2 {
         min-width: 150px;
      }
   }
   .kanban-form {
      text-align: left;
      padding: 10px 10px 10px 10px;
      background-color: white;
      box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
      border: #d3d3d3 1px solid;
      z-index: 10;
      input {
         border-radius: unset !important;
         &[type=checkbox] {
            margin-right: 5px;
         }
         &:not([type=checkbox]) {
            display: block;
         }
         &:not([type=submit]):not([type=checkbox]) {
            width: 90%;
            padding: 5px 10px;
         }
         &[type=submit] {
            margin: auto;
         }
         &[type=button] {
            width: 100%;
         }
      }
      .kanban-item-subtitle {
         font-style: italic;
         font-weight: normal;
      }
      .kanban-item-content {
         margin-bottom: 5px;
         .kanban-columns-list {
            max-height: 50vh;
            overflow-y: auto;
            margin: 10px 0;

            li {
               padding: 5px 0px 0px 0px;
            }
         }
      }
   }
   .kanban-container {
      overflow: auto;
      .kanban-dropdown {
         position: fixed;
         width: max-content;
         min-width: 100px;
         background-color: #f1f1f1;
         border: 1px solid #7f7979;
         text-align: left;

         li {
            background-color: white;
            color: #333333; // Default text color
            margin-top: 2px;
            position: relative;
            a, span {
               color: inherit;
               cursor: pointer;
               display: block;
               font-weight: bold;
               padding: 10px;
               &:hover {
                  background-color: #3a5693;
                  color: white;
               }
               i {
                  color: inherit;
               }
            }
            ul {
               position: absolute;
               left: 100%;
               top: 0;
               display: block;
               width: max-content;
               min-width: 100px;
               background-color: #f1f1f1;
               outline: 1px solid #7f7979; // Use outline instead of border on submenus to avoid them being aligned off by one pixel
               margin-left: 1px;
            }
            i {
               margin-right: 1em;
            }
         }
         li:first-of-type {
            margin-top: 0;
         }
         li.dropdown-trigger {
            &.active {
               background-color: #3a5693;
               color: white;
            }
            a:after {
               content: "\f054";
               font-family: "Font Awesome\ 5 Free";
               font-weight: 900;
               padding-left: 10px;
            }
         }
      }
      .kanban-columns {
         width: max-content; /* Fix overflow when collapsed */
         display: flex;
         .kanban-column {
            margin-right: 8px;
            background-color: #f1f1f1;
            border: #d3d3d3 1px solid;
            min-width: 200px;
            height: 600px;
            border-radius: 5px;
            flex-direction: column;
            flex: 1 0 auto;
            text-align: center;

            &.ui-sortable-helper {
               cursor: grab;
            }

            &.collapsed {
               min-width: unset;
               width: calc(1.2em + 20px);

               .kanban-column-header {
                  box-shadow: unset;

                  .kanban-column-header-content {
                     flex-direction: column;

                     .kanban-collapse-column, .kanban-column-title, .kanban_nb {
                        transform: rotate(90deg);
                        transform-origin: center;
                        display: inline-block;
                        margin: calc(50% - 8px) 0;
                        white-space: nowrap;
                     }

                     .kanban-collapse-column {
                        margin: 0 0 8px 0;
                     }

                     .kanban-column-toolbar {
                        display: none;
                     }
                  }
               }
               .kanban-body {
                  display: none;
               }
            }

            .kanban-column-header {
               background-color: #f1f1f1;
               border-top: 3px solid #f1f1f1;
               box-shadow: 0 1px 1px #dbdbdb;
               font-size: 1.2em;
               padding: 10px;
               margin-bottom: 5px;

               .kanban-column-header-content {
                  display: flex;
                  justify-content: space-between;
                  align-items: center;
               }

               .pointer {
                  opacity: .3;

                  &:hover {
                     opacity: 1;
                  }
               }

               i.fas {
                  cursor: pointer;
                  //flex-direction: column;
                  flex: 0 1 auto;
                  position: relative;
                  // Increase click area to make it easier to collapse/expand boards
                  &:after {
                     content: '';
                     position: absolute;
                     top: -50%;
                     left: -50%;
                     width: 200%;
                     height: 200%;
                  }
               }
               .kanban-column-title {
                  margin-left: 15px;
                  padding: 3px 12px;
                  border-radius: 50px;

                  &.kanban-text-light {
                     color: white;
                  }
                  &.kanban-text-dark {
                     color: black;
                  }
               }
               .kanban_nb {
                  padding: 2px 5px 2px 5px;
                  background-color: white;
                  border-radius: 20px;
                  margin-left: 10px;
               }
               .kanban-column-toolbar {
                  margin-left: auto;
                  flex-direction: column;
                  flex: 0 1 auto;
                  i {
                     margin-left: 12px;
                  }
               }
            }
            .kanban-body {
               min-height: 150px;
               padding: 0 5px 0 5px;
               height: calc(100% - (1.2em + 35px));
               overflow-y: auto;
               overflow-x: hidden;
               .kanban-add-form {
                  input {
                     border-radius: unset !important;
                     display: block;
                     margin: 8px 0 0;
                     padding: 5px 10px;

                     &:not([type=submit]) {
                        width: 90%;
                     }
                     &[type=submit] {
                        margin: auto;
                     }
                  }
                  textarea {
                     border-radius: unset !important;
                     width: 90%;
                     resize: vertical;
                     margin: 8px 0;
                     padding: 5px 10px;
                  }
               }
               .kanban-add-form {
                  padding-top: 10px !important;
                  padding-bottom: 10px !important;
               }

               .kanban-item, .kanban-add-form {
                  text-align: left;
                  padding-left: 0;
                  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
                  min-height: 50px;
                  margin-top: 5px;
                  border-radius: 5px;
                  border: #d3d3d3 1px solid;
                  min-width: 250px;
                  &:not(.deleted) {
                     background-color: white;
                  }
                  &.filtered-out {
                     display: none;
                  }
                  &.ui-sortable-helper {
                     cursor: grab;
                  }
                  .kanban-item-header, .kanban-item-header a {
                     .fas {
                        &:hover {
                           text-decoration: none;
                        }
                        float: right;
                        cursor: pointer;
                     }
                     .kanban-item-title .fas {
                        float: none;
                        &:last-of-type {
                           margin-right: 5px;
                        }
                     }
                     padding: 5px 10px 0;
                     color: black;
                     font-size: 1.1em;
                     font-weight: bold;
                     a:hover {
                        text-decoration: underline;
                     }
                     a {
                        padding: unset;
                     }
                  }
                  .kanban-item-content {
                     padding: 0 10px 0 10px;
                     .kanban-core-content {
                        display: flex;
                        flex-wrap: wrap;
                        margin: 10px 0 10px 0;
                     }
                  }
                  .kanban-item-team {
                     display: flex;
                     padding-right: 10px;
                     padding-bottom: 10px;
                     span:first-of-type {
                        margin-left: auto;
                     }
                     span {
                        margin-right: 2px;
                        img {
                           border-radius: 50%;
                        }
                        &.fa-stack {
                           width: 2em;
                        }
                     }
                  }
               }
            }
         }

         > .sortable-placeholder {
            min-width: 200px;
            height: 600px;
            margin: 0 8px 0 0;
            border-radius: 5px
         }
      }
   }
   .kanban-color-preview, .kanban-column-title {
      &.itilstatus {
         &.assigned, &.new {
            background-color: #49bf4d;
         }

         &.accepted {
            background-color: green;
         }

         &.refused {
            background-color: rgb(167, 47, 0);
         }

         &.test, &.qualif, &.waiting {
            background-color: orange;
         }

         &.approval {
            background-color: #8cabdb;
         }

         &.eval {
            background-color: lightblue;
         }

         &.closed, &.solved, &.observe, &.canceled {
            background-color: black;
         }

         &.planned {
            background-color: #1b2f62;
         }
      }
   }

   .kanban-color-preview {
      width: 1em;
      height: 1em;
      display: inline-block;
      margin-right: 5px;
      vertical-align: middle;
   }

   .sortable-placeholder {
      border: 2px dashed #dad55e;
      background: #fffa90;
      color: #777620;
      height: 40px;
      margin-top: 5px;
      &.invalid-position {
         border: 2px dashed #d3413c;
         background: #ff7370;
         color: #792220;
      }
   }

   .kanban-filters-panel {
      width: fit-content;
      max-width: 80%;

      .accordion-collapse.collapsing {
         transition: none !important;
      }

      .filter-input i.fas {
         font-size: 1.25em;
      }
   }
}